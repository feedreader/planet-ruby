# Day 13 - lumione Gem - Convert currencies in terminal without using an API

Written by {% avatar ledestin %} [Dmitry Maksyoma](https://github.com/ledestin)

_Blogs at [RubyClarity](https://rubyclarity.com),
[Twitter](https://twitter.com/oledestin)_

## There are lots of CLI currency converters, what's unique about Lumione?

It doesn't use an API. No API - no token setup needed and no limits on usage.
Also:
  * API changes won't break it.
  * **It actually works** and is likely to keep working without me working on
    it. I've seen my share of broken CLI currency calculators.
  * It uses [Money gem](https://github.com/RubyMoney/money), and it's a stable
    interface.

Some caveats about rates:
  * It has support only for the currencies that [eu_central_bank](https://github.com/RubyMoney/eu_central_bank) gem supports. It
    was a tradeoff favouring development speed and maintenance.
  * EU central bank rates are updated not in real time. I find it's **good
    enough for casual conversations** about prices.
  * Lumione updates rates every 24 hours (if you run it), but EU central bank
    may not update them as often, so sometimes rates go unchanged for a couple
    of days.

## How to use it

```
$lumione 13 nzd usd
$13.00 NZD ($9.16 USD) (rates updated 3 days ago)
```

Install with `gem install lumione`.

## To speed up development, I used Money gem

I could've used an API to get exchange rates, and then write code to convert
between currencies. There are issues though, like Japanese yen being all
"cents", with no concept similar to 100 cents == 1 dollar. Japanese yen are
always "cents", be it 1000 yen or 10000 yen. I'd have to take that into
consideration, while writing conversion code.

Thankfully, Money gem takes care of that. With Money gem, currency conversion is very easy. The main issue is to have exchange rates available. I get rates via
[eu_central_bank](https://github.com/RubyMoney/eu_central_bank) gem.
When used without caching,
[eu_central_bank](https://github.com/RubyMoney/eu_central_bank) is very easy to
use:

```
require "lumione/initializer"

def convert(amount, from_currency, to_currency)
  @original_money = Money.from_amount(amount, from_currency)
  @converted_money = @original_money.exchange_to(to_currency)
end

Money.default_bank.update_rates
convert 1, "nzd", "usd"
puts @converted_money.format(with_currency: true)
```

[lumione/initializer](https://github.com/ledestin/lumione/blob/master/lib/lumione/initializer.rb) sets up Money gem and `EuCentralBank` as `default_bank`.

You can use `Money.from_amount 100, "jpy"` and `Money.from_amount 100, "usd"`,
and it'll take care of it. And `#exchange_to` converts to the target currency.

`#update_rates` loads exchange rates from internet, probably from EU Central
bank website.

However, caching rates [complicates things quite a
bit](https://github.com/ledestin/lumione/blob/master/lib/lumione/bank.rb).

## To speed up development, I used a Rails ActionView helper

I was after using
[#distance_of_time_in_words_to_now](https://apidock.com/rails/ActionView/Helpers/DateHelper/distance_of_time_in_words).
You could see it in action earlier, when you saw "(rates updated 3 days ago)".
"3 days ago" was generated by `#distance_of_time_in_words`.

Many people suggest reimplementing things, rather than adding dependencies, but
I don't believe in that. I'd rather save time and use somebody else's code. Of
course, dependencies should be chosen carefully.

To use `#distance_of_time_in_words` outside Rails is easy:
```
require "active_support/core_ext/numeric/time"
require "action_view"

class Foo
  include ActionView::Helpers::DateHelper

  def foo
    distance_of_time_in_words 3.minutes
  end
end

puts Foo.new.foo
```

## To speed up development, I used optparse-plus gem

Handling CLI arguments and options can be annoying and require effort, but not
so with [optparse-plus](https://github.com/davetron5000/optparse-plus).

For example, CLI arguments are defined like this:
```
arg :amount
arg :original_currency
arg :converted_to_currency
```

And, when I run `lumione`, I get this:
```
Usage: lumione [options] amount original_currency converted_to_currency

Convert money in one currency into another

v0.1.0

Options:
    -h, --help                       Show command line help
        --version                    Show help/version info
        --log-level LEVEL            Set the logging level
                                     (debug|info|warn|error|fatal)
                                     (Default: info)
```

All automatic! And it'll tell user if an arument is missing.

And, [optparse-plus](https://github.com/davetron5000/optparse-plus) generates
`./bin/lumione` and `./lib`, and a gemspec, so it's really worth using it.

## References

* [Lumione](https://github.com/ledestin/lumione)
* [optparse-plus](https://github.com/davetron5000/optparse-plus)
* [Money gem](https://github.com/RubyMoney/money)
* [eu_central_bank](https://github.com/RubyMoney/eu_central_bank)
